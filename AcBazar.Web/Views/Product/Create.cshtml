@model List<ProductSpecs>
@{
    ViewBag.Title = "Create Product";
}


<header>
    @Scripts.Render("~/Content/javascript/jquery.min.js")
</header>


<section class="flat-row flat-contact">

    <!-- Blog posts -->
    <section class="blog-posts style1">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="title-section margin_bottom_17">
                        <h2 class="title">
                            Create Product
                        </h2>
                    </div><!-- /.title-section -->
                </div><!-- /.col-md-12 -->
            </div><!-- /.row -->

            <div class="row">
                <div class="col-md-9">
                    <div class="post-wrap style1">

                        <article class="post clearfix">
                            <div class="title-post">
                                <h2><a href="blog-detail.html">Product Information</a></h2>
                            </div><!-- /.title-post -->
                            <form id="CreateProduct" method="post">
                                <div class="content-post ">
                                    <div class="meta-post">
                                        <div class="featured-post">
                                            @*<span>Posted By: </span><a href="#">Admin</a>*@
                                            <label>Product Type</label>
                                            <select name="ProductTypeId" aria-required="true" class="form-control form-control-lg">
                                                @foreach (var productTypeList in ViewBag.ProductTypeList)
                                                {
                                                    <option value="@productTypeList.ID">@productTypeList.Name</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="featured-post">
                                            @*<span>Posted By: </span><a href="#">Admin</a>*@
                                            <label>Category</label>
                                            <select name="CategoryId" aria-required="true" class="form-control form-control-lg">
                                                @foreach (var categoryList in ViewBag.CategoryList)
                                                {
                                                    <option value="@categoryList.ID">@categoryList.Name</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="featured-post">
                                            @*<span>Posted By: </span><a href="#">Admin</a>*@
                                            <label>Brand</label>
                                            <select name="BrandId" aria-required="true" class="form-control form-control-lg">
                                                @foreach (var brandList in ViewBag.BrandList)
                                                {
                                                    <option value="@brandList.ID">@brandList.Name</option>
                                                }
                                            </select>
                                        </div>
                                    </div><!-- /.meta-post -->

                                    <div class="featured-post">
                                        <label>Name</label>
                                        <input type="text" size="30" name="Name" aria-required="true">
                                    </div>
                                    <ul class="meta-post">
                                        <li class="author padding-left-2 col-md-5">
                                            <label>Price</label>
                                            <input type="text" size="30" name="Price" aria-required="true">
                                        </li>
                                        <li class="author padding-left-2 col-md-5">
                                            <label>Discount</label>
                                            <input type="text" size="30" name="AmountDis" aria-required="true">
                                        </li>
                                    </ul><!-- /.meta-post -->

                                    <div class="contact-message clearfix">
                                        <label>Description</label>
                                        <textarea tabindex="4" id="txtDescription" size="30" name="Description" required=""></textarea>
                                    </div>


                                    <ul class="meta-post">
                                        <li class="author padding-left-2 col-md-5">
                                            <label>Is Sale:</label>
                                            <input name="IsSale" type="checkbox" style="display:initial" />
                                            <label>Is New:</label>
                                            <input name="IsNew" type="checkbox" style="display:initial" />
                                            <label>Is Best:</label>
                                            <input name="IsBest" type="checkbox" style="display:initial" />
                                            <label>Is Cancel:</label>
                                            <input name="IsCancel" type="checkbox" style="display:initial" />

                                        </li>
                                    </ul><!-- /.meta-post -->

                                    <ul class="meta-post">
                                        <li class="author padding-left-2 col-md-5">
                                            <input type="hidden" name="RowAddDate" value="@System.DateTime.Now" />
                                            <input name="ImageURL" type="hidden" id="ImageURL" />
                                            @*
                                        <input type="file" size="30" name="Image" aria-required="true" id="ImageUpload" accept=".jpg, .png">
                                            *@
                                        </li>
                                    </ul><!-- /.meta-post -->

                                    <div class="featured-post">

                                    </div>
                                    <div class="entry-post">
                                        @*<p>When the Tunisian-born couturier Azzedine Alaïa passed away in Paris on November 18, tributes began pouring in from the fashion world, as his friends and fans celebrated his work and sought to preserve his legacy. Now, London's Design Museum has announced that it will...</p>
                                    <div class="more-link">
                                        <a href="blog-detail.html">Read More</a>
                                    </div>*@
                                    </div>
                                </div><!-- /.content-post -->
                            </form>

                            <form id="CreateProductDetail" method="post">
                                <div class="form-text-wrap clearfix">
                                    <table id="tblProductDetail">
                                        <tr>
                                            <td colspan="2"><h2><u>Item Specification</u></h2></td>
                                        </tr>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>
                                                    <input class="txtproductid" type="hidden" placeholder="ProductID" size="30" name="ProductID" id="txtProductID" cid="">
                                                    <input class="txtSpecKey" type="hidden" placeholder="SpecKey" size="30" name="ProductSpecsID" id="txtSpecKey" cid="@item.SpecKey" value="@item.SpecKey">
                                                    <label style="text-align:center">@item.SpecValue</label>
                                                </td>
                                                <td>
                                                    @if (item.SpecInputValueType == "LongString")
                                                    {
                                                        <textarea class="txtName" tabindex="4" size="30" name="Name"  id="txtName" required=""></textarea>
                                                    }
                                                    else
                                                    {
                                                        <input class="txtName" type="text" placeholder=@item.SpecValue size="30" name="Name" id="txtName" value="">
                                                    }
                                                </td>
                                            </tr>
                                        }
                                        <tr class="form-submit">
                                            <td>
                                                <button type="button" class="contact-submit" id="btnSave">SAVE</button>
                                                <button type="button" class="contact-submit" id="btnCancel">CANCEL</button>
                                            </td>
                                        </tr>
                                    </table>

                                </div>
                            </form>

                        </article><!-- /.post -->

                    </div><!-- /.post-wrap -->
                </div><!-- /.col-md-9 -->
                <div class="col-md-3">
                    <div class="sidebar">
                        <div class="widget widget_categories">
                            <h5 class="widget-title">Picture</h5>
                            <div class="featured-post">
                                <input type="file" size="30" name="Image" aria-required="true" id="ImageUpload" accept=".jpg, .png">
                                <img id="ProductImage" src="~/Content/images/blog/4.jpg" alt="image">
                            </div>
                        </div><!-- /.widget-categories -->
                    </div><!-- /.sidebar -->
                </div><!-- /.col-md-3 -->
            </div><!-- /.row -->
        </div><!-- /.container -->
    </section><!-- /.blog posts -->

</section><!-- /.flat-row -->

<script>
    @*

    $("#btnLoopTest").click(function () {
        var productSpecMapp = [];
        $("#tblProductDetail tr").each(function () {
            //var get_id = $(".txtSpecKey").attr("cid");
            productSpecMapp.push({ ProductID: $(this).find('input[name="ProductID"]').val() });
            productSpecMapp.push({ ProductSpecsID: $(this).find('input[name="ProductSpecsID"]').val() });
            productSpecMapp.push({ SpecValue: $(this).find('input[name="SpecValue"]').val() });
            productSpecMapp.push({ Name: $(this).find('input[name="Name"]').val() });
            //things = JSON.stringify({ 'things': things });
            //alert("Value-" + get_id + "-Value2-" + get_id2 + "-Value3-" + get_id3 + "-Value4-" + get_id4);
        });
        debugger;
        productSpecMapp = JSON.stringify({ 'productSpecMapp': productSpecMapp });
    });
*@

    //New code
@*

    $("#btnLoopTest").click(function () {

        var things = [
            { id: 1, color: 'yellow' },
            { id: 2, color: 'blue' },
            { id: 3, color: 'red' }
        ];
        debugger;
        things = JSON.stringify({ 'things': things });

        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'POST',
            url: '/Home/PassThings',
            data: things,
            success: function () {
                $('#result').html('"PassThings()" successfully called.');
            },
            failure: function (response) {
                $('#result').html(response);
            }
        });

        *@

    $("#btnLoopTest").click(function () {
        var productSpecMapp = [];
        $("#tblProductDetail tr").each(function () {
            var productID = 1;
            //var productSpecsID = 1;
            var productSpecsID = $(this).find('input[name="ProductSpecsID"]').val();
            var name = $(this).find('input[name="Name"]').val();
            name = $(this).find('textarea[name="Name"]').val();
            var a = { ProductID: productID, ProductSpecsID: productSpecsID, Name: name };
            productSpecMapp.push(a);
        });
        productSpecMapp = JSON.stringify({ 'productSpecMapp': productSpecMapp });
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'POST',
            url: '@Url.Action("CreateProductDetail", "Product")',
            data: productSpecMapp,
            success: function () {
                $('#result').html('"PassThings()" successfully called.');
            },
            failure: function (response) {
                $('#result').html(response);
            }
        });

    });

</script>


<script>
        @*$("#btnSave").click(function () {
        //var tsearch = $("#txtSearch").val();
        // alert("BTN SAVE CLICK");
        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "Product")',
            data: $("#CreateProduct").serialize()
        })
            .done(function (response) {
                if (response) {
                      var productSpecMapp = [];
                            $("#tblProductDetail tr").each(function () {
                                var productID = response.PID;
                                var specKey = $(this).find('input[name="ProductSpecsID"]').val();
                                var name = $(this).find('input[name="Name"]').val();
                                var a = { ProductID: productID, SpecKey: specKey, Name: name };
                                productSpecMapp.push(a);
                            });
                            productSpecMapp = JSON.stringify({ 'productSpecMapp': productSpecMapp });
                            $.ajax({
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                type: 'POST',
                                url: '@Url.Action("CreateProductDetail", "Product")',
                                data: productSpecMapp,
                                success: function () {
                                    $('#ActionContainer').html('"PassThings()" successfully called.');
                                },
                                failure: function (response) {
                                    $('#ActionContainer').html(response);
                                }
                            });
                }
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Failed');
            });
    });*@

        $("#btnSave").click(function () {
        //var tsearch = $("#txtSearch").val();
        // alert("BTN SAVE CLICK");
        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "Product")',
            data: $("#CreateProduct").serialize()
        })
            .done(function (response) {
                if (response) {
                      var productSpecMapp = [];
                            $("#tblProductDetail tr").each(function () {
                                var productID = response.PID;
                                var specKey = $(this).find('input[name="ProductSpecsID"]').val();
                                debugger;
                                var name = $(this).find('input[name="Name"]').val();
                                if (name == null || name=="") {
                                    name = $(this).find('textarea[name="Name"]').val();
                                }
                                var a = { ProductID: productID, SpecKey: specKey, Name: name };
                                productSpecMapp.push(a);
                            });
                    productSpecMapp = JSON.stringify({ 'productSpecMapp': productSpecMapp });
                        $.ajax({
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            type: 'POST',
                            url: '@Url.Action("CreateProductDetail", "Product")',
                            data: productSpecMapp
                        })
                            .done(function (data) {
                                if (data) {
                                    //$("#ImageURL").val(response.ImageURL);
                                    $.ajax({
                                        type: "GET",
                                        url: '@Url.Action("ProductInfo", "Product")'
                                    })
                                        .done(function (data) {
                                            $("#SearchProduct").html(data);
                                        })
                                        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                                            alert('Failed');
                                        });

                                    $.ajax({
                                        type: "GET",
                                        url: '@Url.Action("Create", "Product")'
                                    })
                                        .done(function (data) {
                                            $("#ActionContainer").html(data);
                                            focusaction("ActionContainer");
                                        })
                                        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                                            alert('Failed');
                                        });
                                }

                            })
                            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                                debugger;
                                alert('Failed');
                            });
                }
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Failed');
            });
    });


    @*
    $("#btnSave").click(function () {
        //var tsearch = $("#txtSearch").val();
        // alert("BTN SAVE CLICK");
        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "Product")',
            data: $("#CreateProduct").serialize()
        })
            .done(function (data) {
                $("#SearchProduct").html(data);
                $("#ActionContainer").html("");
                focusaction("SearchProduct");
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Failed');
            });
    });
        *@
        $("#btnCancel").click(function () {
            $("#ActionContainer").html("");
            focusaction("SearchProduct");
        });
</script>

<script>
    $("#ImageUpload").change(function () {
        var element = this;
        var formData = new FormData();
        var totalFiles = element.files.length;
        for (i = 0; i < totalFiles; i++) {
            var file = element.files[i];
            formData.append("Photo", file);
        }

        $.ajax({
            type: "POST",
            url: '@Url.Action("UploadImage", "Shared")',
            //dataType:'json',
            data: formData,
            contentType: false,
            processData: false
        })
            .done(function (response) {
                console.log(response);
                if (response) {
                    $("#ProductImage").attr("src", response.ImageURL);
                    $("#ImageURL").val(response.ImageURL);
                }
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                //debugger;
                alert('Failed');
            });

    });
</script>
